def withoutdb00x() {
//echo "Hello from runcmd function. Executing on the $environment branch. Running on DB name ${environment}_${DBNODE}"
echo "Hello from withoutdb00x function. Executing on the $environment branch ${gitBranch} on DB Node ${environment}_${DBNODE}  command ${command1} with Database ${DBNAME}"
}

def withonlydb00x() {
//echo "Hello from withdb00x function. Executing on the $environment branch. Running on DB name ${environment}_${DBNODE}"
echo "Hello from withdb00x function. Executing on the $environment branch ${gitBranch} on DB Node ${environment}  command ${command1} with Database ${DBNAME}"
}

pipeline {
    agent any
    stages {
       stage('Read the variables of mybatisddl and command') {
          steps {
                script {
                def datas = readYaml file: 'mybatisddl.yml'
                command1=datas."${environment}".command
                dblist1=datas."${environment}".dblist
                dbnode1=datas."${environment}".dbnode
                echo "Got my command ${command1} from ${environment} environment"
		//list.each {println it }
                       }
                }
							     }


	 stage('List DB') {
          steps {
                script {
                      dblist1.each {
				echo "Looking on ${environment} environment with database ${it}"
				DBNAME = it
			dbnode1.each {
				echo "I am working on ${environment} environment with DBNODE ${it}"
				DBNODE = it
			if ($DBNAME = "dbtemp" || $DBNAME = "dbcopy" || $DBNAME = "dbreplicate") { 
	                then 
        	        if  (${environment} = "perf" ] || [ ${environment} = "prod" ] || [ ${environment} = "dr") {
                	then
				withoutdb00x()
			else {
                                withonlydb00x()
			     }
														  }
												  }

				 }
                       }
        	}
                           }
			}


// closing for pipeline and stages
}
}
